<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Controle de Horas - Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body{
  font-family: Arial, Helvetica, sans-serif;
  background: linear-gradient(135deg,#1e3c72,#2a5298);
  min-height:100vh;
  margin:0;
  display:flex;
  align-items:center;
  justify-content:center;
}
.container{
  background:#fff;
  width:100%;
  max-width:520px;
  padding:25px;
  border-radius:14px;
  box-shadow:0 15px 30px rgba(0,0,0,.25);
}
h2,h3{margin-top:0;text-align:center}
input,select,button{
  width:100%;
  padding:12px;
  margin:8px 0;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:15px;
}
button{
  background:#2a5298;
  color:#fff;
  border:none;
  cursor:pointer;
}
button:hover{background:#1e3c72}
.hidden{display:none}
.nav{
  display:flex;
  gap:10px;
  margin-bottom:15px;
}
.nav button{
  flex:1;
}
.logout{background:#c0392b}
.logout:hover{background:#922b21}
.list{
  max-height:200px;
  overflow:auto;
  border:1px solid #ddd;
  border-radius:8px;
  padding:10px;
}
.item{
  border-bottom:1px solid #eee;
  padding:6px 0;
  font-size:14px;
}
.item:last-child{border:none}
</style>
</head>
<body>

<div class="container" id="login">
  <h2>Login</h2>
  <input id="loginUser" placeholder="Usuário" />
  <input id="loginPass" type="password" placeholder="Senha" />
  <button onclick="doLogin()">Entrar</button>
</div>

<div class="container hidden" id="app">
  <h2 id="welcome"></h2>

  <div class="nav">
    <button onclick="showTab('registro')">Registrar Horas</button>
    <button onclick="showTab('historico')">Histórico</button>
    <button id="adminBtn" onclick="showTab('admin')">Admin</button>
  </div>

  <!-- REGISTRO -->
  <div id="registro" class="tab">
    <h3>Registrar horas</h3>
    <input type="date" id="day" />
    <input type="time" id="entrada" />
    <input type="time" id="saida" />
    <button onclick="saveHours()">Salvar</button>
  </div>

  <!-- HISTÓRICO -->
  <div id="historico" class="tab hidden">
    <h3>Histórico</h3>
    <div class="list" id="historyList"></div>
  </div>

  <!-- ADMIN -->
  <div id="admin" class="tab hidden">
    <h3>Cadastrar usuário</h3>
    <input id="newUser" placeholder="Novo usuário" />
    <input id="newPass" placeholder="Senha" />
    <button onclick="createUser()">Criar usuário</button>
  </div>

  <button class="logout" onclick="logout()">Sair</button>
</div>

<script>
// estrutura inicial
let data = JSON.parse(localStorage.getItem('data')) || {
  users:{
    admin:{ password:'admin123', role:'admin' }
  },
  hours:{}
};

function saveData(){
  localStorage.setItem('data', JSON.stringify(data));
}

function doLogin(){
  const u = loginUser.value.trim();
  const p = loginPass.value.trim();
  if(data.users[u] && data.users[u].password === p){
    localStorage.setItem('logged', u);
    loadApp();
  }else{
    alert('Login inválido');
  }
}

function loadApp(){
  const u = localStorage.getItem('logged');
  if(!u) return;

  login.classList.add('hidden');
  app.classList.remove('hidden');
  welcome.innerText = `Usuário: ${u}`;

  if(data.users[u].role !== 'admin'){
    adminBtn.style.display='none';
  }

  showTab('registro');
  loadHistory();
}

function logout(){
  localStorage.removeItem('logged');
  location.reload();
}

function showTab(id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

function saveHours(){
  const u = localStorage.getItem('logged');
  const d = day.value;
  if(!d) return alert('Selecione o dia');

  if(!data.hours[u]) data.hours[u] = {};
  data.hours[u][d] = {
    entrada: entrada.value,
    saida: saida.value
  };
  saveData();
  loadHistory();
  alert('Registro salvo');
}

function loadHistory(){
  const u = localStorage.getItem('logged');
  historyList.innerHTML='';
  if(!data.hours[u]) return;

  Object.keys(data.hours[u]).sort().forEach(d=>{
    const h = data.hours[u][d];
    const div = document.createElement('div');
    div.className='item';
    div.innerText = `${d} | Entrada: ${h.entrada} | Saída: ${h.saida}`;
    historyList.appendChild(div);
  });
}

function createUser(){
  const u = newUser.value.trim();
  const p = newPass.value.trim();
  if(!u || !p) return alert('Preencha tudo');
  if(data.users[u]) return alert('Usuário já existe');

  data.users[u] = { password:p, role:'user' };
  saveData();
  alert('Usuário criado');
  newUser.value=''; newPass.value='';
}

loadApp();
</script>

</body>
</html>
